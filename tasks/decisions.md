# 의사결정 로그

## 2026-02-22 | 업무 관리 체계 수립
> 원본: `conversations/2026-02-22-세션1.md#업무-관리-체계-수립`

### 결정 사항
1. 업무는 로컬 폴더와 문서로 관리, 깃은 버전 관리 용도로만 사용
2. 도메인별 원칙 문서를 분리하고 AGENTS.md에서 참조하는 구조 채택
3. 공유 맥락은 깃 문서에, AI 로컬 메모리는 환경 정보만 보관
4. 업무 분류는 도메인 + 프로젝트 두 축, 플랫 구조로 시작
5. 대화 원시 데이터는 각 저장소에 저장, 비서실장이 로컬 경로로 수렴
6. 핵심 문서 수정 시 반드시 사용자 합의 필요

### 근거
- 불확실성이 클 때는 단순하게 시작하고 점진적으로 개선
- 여러 PC 환경에서 동기화 필요
- 하위 프로젝트는 별도 저장소로 분리되어 있으나 같은 PC에서 접근 가능

## 2026-02-22 | Agentic Engineering 방법론 프로젝트
> 원본: `conversations/2026-02-22-세션1.md#agentic-engineering-프로젝트`

### 결정 사항
1. 프로젝트 3축 구조: collaboration / development / service-design
2. 기술적 결(Technical Grain)을 범용 원칙으로 추출, Next.js 특화 내용은 제외
3. 웹 기본 계약 7가지 → 비판적 검토 후 계약(5) + 검증(2)으로 재구성, 상위 문서에 통합
4. AI 서비스 설계의 핵심 전제 두 축: "자율성은 디자인 선택" + "AI는 동료 수준의 주체"
5. 자율성 프레임워크는 서비스 설계 원칙에서 관리, technical-grain.md은 참조
6. RESTful은 별도 원칙이 아니라 웹 계약의 결과 — 리소스 중심이면 자연스럽게 성립

### 근거
- 범용 원칙과 구현 가이드를 분리해야 여러 프로젝트에 적용 가능
- mirror-mind 철학이 서비스 설계에 직접 반영되어야 함
- 앞으로 AI 서비스에는 동료 레벨의 에이전트가 존재해야 한다는 사용자 비전

## 2026-02-22 | 회고에서 도출된 운영 개선
> 원본: `conversations/2026-02-22-세션1.md#회고`

### 결정 사항
1. inbox 제거 — AI 협업에서는 수집과 구조화가 동시에 일어남
2. 문서 분리/통합 기준: 독립적 의미 여부 + 추상화로 상위 흡수 가능 여부
3. 비판적 검토 → 추상화 → 통합 패턴을 운영 원칙으로 채택

### 근거
- 실제 운영에서 inbox를 한 번도 사용하지 않음
- 하위 문서 생성 후 통합으로 돌아온 사례가 반복됨
- 비판적 검토가 추상화를 이끌고 구조를 단순하게 만든 실전 경험

## 2026-02-22 | 정합성 검증 및 문서 정리
> 원본: `conversations/2026-02-22-세션1.md#정합성-검증`

### 결정 사항
1. collaboration-framework.md 제거 — 내용이 상위 문서에 모두 흡수됨
2. 정합성 검증은 AI가 직접 전체 문서를 읽고 수행한다 (별도 스크립트 불필요)
3. 대화 원시 데이터를 conversations/ 폴더에 저장, decisions.md에서 섹션 앵커로 참조

### 근거
- 독립적 의미를 갖지 못하는 문서는 통합이 기본값 (운영 원칙 적용)
- 자연어 정합성 검증은 근본적으로 자연어 이해 문제 — AI가 직접 수행이 가장 실용적
- 의사결정 로그만으로는 맥락 깊이가 부족, 원시 대화 참조가 필요

## 2026-02-22 | 세션 관리 방식
> 원본: `conversations/2026-02-22-세션1.md#세션-관리-방식-논의`

### 결정 사항
1. 세션 시작 절차를 AGENTS.md에 명시
2. 세션 종료 시 decisions.md 업데이트 + 대화 파일 저장

### 근거
- 새 세션의 AI가 맥락을 빠르게 복원하려면 절차가 명시되어야 함
- CLAUDE.md는 진입점으로 가볍게 유지, 운영 절차는 AGENTS.md에

## 2026-02-22 | 소통 톤 규정 및 자율 커밋
> 원본: `conversations/2026-02-22-세션2.md#톤-규정-수립`

### 결정 사항
1. 동료 레벨 ~다 체 사용, 존댓말(~습니다) 금지 — mirror-mind-principle.md에 명시
2. 경미한 변경(단일 문서 수정 등)은 AI가 자율적으로 커밋·푸시

### 근거
- 컨텍스트 압축 후 톤이 존댓말로 바뀌는 현상 발생 — 명시적 규정 필요
- 작은 변경마다 커밋 지시를 기다리는 것은 비효율

## 2026-02-22 | 기술적 결 확장 (안전장치·지식 공급·관측)
> 원본: `conversations/2026-02-22-세션2.md#기술적-결-확장`

### 결정 사항
1. 안전장치를 Agent Plane에 추가: 코드 레벨(샌드박싱, 린트/SAST 필수) + 비즈니스 레벨(승인 워크플로, 60초 롤백, 비용 상한)
2. Context7 MCP를 에이전트 개발 환경에 기본 설치
3. 관측 체계 5계층 + 모니터링·디버깅 구현 가이드라인 추가

### 근거
- 에이전트가 코딩하므로 안전장치가 자율성 수준에 비례해야 함
- 학습 시점 지식의 한계를 외부 지식 공급으로 보완
- 서비스 코드와 관측 코드는 동시에 작성하는 것이 원칙

## 2026-02-22 | 메타에이전트 도입
> 원본: `conversations/2026-02-22-세션2.md#메타에이전트-구축`

### 결정 사항
1. 원칙 준수를 상시 감시하는 메타에이전트 도입
2. 세션 시작 시 백그라운드로 실행 (5분 간격)
3. meta-agent/ 별도 폴더에 스크립트와 원칙 문서를 관리
4. AGENTS.md 도메인 문서 목록에 등록

### 근거
- 일반 에이전트가 일을 하고, 메타에이전트가 일하는 방식을 감시하는 구조
- 세션 중 JSONL을 실시간으로 읽을 수 있어 상시 감시 가능
- 프로그램적 점검(톤, 참조 무결성 등)과 LLM 기반 점검(순응, 목적 내재화 등)을 분리

## 2026-02-22 | Light House 대원칙 수립 + 문서 얼라인
> 원본: `conversations/2026-02-22-세션3.md#대원칙-수립`

### 결정 사항
1. Light House는 "연구 동료 에이전트 서비스" — mirror-mind 동료 원칙이 서비스 목적에 적용
2. 에이전트 계층: 상위 에이전트(오케스트레이터, 연구 동료) + 하위 에이전트들(분석, 번역, 클러스터링 등)
3. 원칙 원본은 mirror-mind `projects/lighthouse/service-principles.md`에서 관리
4. `DESIGN_PRINCIPLES.md` → `ai-design-framework.md` 리네이밍, 핵심 전제에 "AI는 연구 동료" 추가
5. `architecture.md`에 도메인 결 판단, 3-Plane 매핑, 관측 체계(설계), 데이터 모델 매핑 추가
6. 비용 상한 정책은 프로토타입 단계이므로 스킵

### 근거
- "연구 동료"가 서비스 정체성이므로 대원칙으로 격상해야 함
- 상위 에이전트가 워크플로를 조율하는 오케스트레이션 레이어가 필요 (현재 workflow 파이프라인의 승격)
- mirror-mind에서 파생된 원칙이므로 원본을 mirror-mind에 두고 lighthouse가 참조
- 관측 체계는 설계만 먼저, 구현은 하위 에이전트에게 위임

## 2026-02-22 | 방법론 역수입 (Light House → mirror-mind)
> 원본: `conversations/2026-02-22-세션3.md#방법론-역수입`

### 결정 사항
1. `ai-service-design-principles.md`에 새 AI 기능 설계 체크리스트 추가 (7단계)
2. `technical-grain.md`에 FSM 게이트 패턴 추가 — 자율성 레벨을 전이 함수로 강제
3. `technical-grain.md`에 원칙-구현 정합성 문서 패턴 추가
4. `technical-grain.md`에 프로젝트 문서 계층 패턴 추가
5. 신뢰도 시각화 독립 섹션은 역수입하지 않음

### 근거
- 체크리스트는 lighthouse에서 실전 검증된 설계 절차
- FSM은 "버튼 비활성화가 아니라 전이 함수가 정책을 통제한다"는 실전 교훈
- 정합성 문서는 원칙이 코드로 집행되는지 검증하는 장치 — lighthouse에서 발견된 패턴
- 문서 계층은 6개 문서 체계가 자연스럽게 형성한 구조를 범용화

## 2026-02-22 | 운영 개선 — 주제 전환 + 트리거 지시문
> 원본: `conversations/2026-02-22-세션4.md#운영-개선`

### 결정 사항
1. 주제 전환 시 체크포인트 원칙 추가 (task-management-principle.md)
2. 트리거 지시문 6개를 AGENTS.md에 명시 (작업 시작/종료, 주제 전환, 정합성 검증, 회고, 원칙 점검)

### 근거
- 세션 중 주제 전환이 반복 발생, 컨텍스트 압축 시 맥락 휘발 위험
- 암묵적 행동을 명시적 트리거로 정의해야 일관성 보장

## 2026-02-22 | Light House 대원칙 기반 코드 재설계 판단
> 원본: `conversations/2026-02-22-세션4.md#phase-abc-판단`

### 결정 사항
1. Phase A (오케스트레이터 추출): 즉시 진행 → 완료
2. Phase B (에이전트 인터페이스): 보류. 교체 가능한 에이전트가 필요해지면 도입
3. Phase C (연구 의도 모델): 보류. 프롬프트 실험으로 효과 검증 먼저
4. 기존 코드는 프로토타입이므로 대원칙 중심 재설계 허용

### 근거
- Phase B: 1:1 매핑 함수에 인터페이스를 씌우면 간접 참조만 증가. 실익 불분명
- Phase C: AI 프롬프트 변경 수반. 구조부터 만들면 품질 미검증 상태에서 복잡도만 증가
- 코드 복잡도 증가 우려: 원칙 정렬이 코드를 복잡하게 만들면 본말전도

## 2026-02-22 | 관측 체계 설계
> 원본: `conversations/2026-02-22-세션4.md#관측-체계-설계`

### 결정 사항
1. 관측 범위: 프로토타입 최소 (AI 호출·API·오케스트레이션·워크플로·비즈니스 로직)
2. 문서 위치: lighthouse `docs/observability.md` (독립 문서, architecture.md 하위)
3. 구현: app/lib/observe.ts 단일 파일, 구조화된 JSON console.log
4. 호출 빈도 모니터링 포함 (무한 루프/중복 트리거 감지)
5. 과다 호출 방지(안전장치)는 관측 범위 밖, Agent Plane에서 별도 설계
6. lighthouse docs에서 mirror-mind 참조 제거 — 하위 프로젝트는 상위를 모르게 한다

### 근거
- 프로토타입 단계에서 과도한 관측 인프라는 불필요
- 감지(관측)와 방지(안전장치)는 다른 관심사
- 하위 프로젝트의 문서 자체 완결성 확보

## 2026-02-22 | 역할 경계 명시 + 메타에이전트 리마인드
> 원본: `conversations/2026-02-22-세션5.md`

### 결정 사항
1. mirror-mind 세션 역할 경계를 task-management-principle.md에 명시: 설계·조율·의사결정만 담당, 코드 구현은 하위 프로젝트 에이전트
2. 메타에이전트 매 주기 원칙 리마인드 출력 (위반 유무와 무관)
3. 트리거(주제 전환, 작업 종료) 발동 시 메타에이전트 리포트 확인을 선행 단계로 추가
4. 기존 LLM 점검 항목 "목적 미탐구"가 역할 경계 위반을 잡을 수 있음 — 구현 필요

### 근거
- 세션이 길어지면 컨텍스트 압축으로 초기 지시가 약화됨
- 메타에이전트는 유일한 정기적 메커니즘. 리마인드를 매 주기 출력하면 트리거 시점에 원칙을 재주입할 수 있음
- 새 규칙을 추가하는 것이 아니라 기존 원칙(목적의 내재화)에 대한 감시를 작동시키는 것

## 2026-02-23 | Light House 서비스 설계 문서 재구성
> 원본: `conversations/2026-02-23-세션6.md`

### 결정 사항
1. ai-design-framework.md를 service-principles.md에 흡수 후 삭제 — 계층 역전 해소
2. 문서 역할을 WHY/WHAT/HOW/CHECK/WATCH/RULES로 명확히 분리
3. SPEC.md에서 기술 구현 내용(기술 스택, 기능 모듈, 컴포넌트, 성능)을 architecture.md로 이관
4. lighthouse 문서는 자체 완결 — mirror-mind 외부 참조(technical-grain.md 등) 제거
5. 10분 주기 주요 문서 재읽기를 세션 운영 절차에 추가

### 근거
- ai-design-framework.md는 대원칙 확립 이전에 작성되어 핵심 정의를 하위 문서가 소유하는 계층 역전 발생
- 문서 분리/통합 기준 적용: ai-design-framework는 lighthouse 없이 독립적 의미 없음, 추상화로 상위 흡수 가능 → 통합이 기본값
- SPEC(WHAT)과 architecture(HOW)의 관심사 분리로 중복 제거 (511줄 삭제, 343줄 추가)
- lighthouse는 mirror-mind의 클론+변형이므로 프로젝트 내부 정합성만 확보하면 됨

## 2026-02-23 | Light House 대원칙 재정의 + 서비스 재설계 착수
> 원본: `conversations/2026-02-23-세션7.md`

### 결정 사항
1. 상위 에이전트의 정체성 전환: 오케스트레이터 → **대화형 연구 동료**. 서비스 경험 전반을 기억하고 연구 방향을 함께 논의하는 주체
2. 핵심전제 2번(상호 보완적 시너지)이 1번(연구 의도 내재화)을 돕는 구조: 의도를 내재화했기에 주도권을 제안할 수 있다
3. 오케스트레이션도 연구 동료가 담당 — 맥락을 가장 잘 아는 주체가 워크플로도 조율하는 것이 자연스럽다
4. 서비스를 처음부터 재설계. 레거시 호환 고려 안 함. 기존 문서는 재료
5. SPEC.md 완전 재작성 — 5개 새 UI/UX 개념 도입:
   - **대화 캔버스**: 대화가 메인 인터페이스, 구조화 데이터가 인라인으로 공존
   - **제안 카드**: 동료가 다음 행동 + 주도권 수준 + 근거를 제안
   - **연구 아티팩트**: 대화에서 생성되어 축적되는 구조화된 결과물
   - **경험 기억**: 연구 여정 전체를 기억, 세션 간에도 지속
   - **주도권 신호**: 현재 누가 주도하는지 시각적 표시
6. **동적 자율성**: 자율성 수준은 기능별 고정이 아니라, 동료가 맥락에 따라 조절해서 제안
7. 안전망 매핑: Phase별 → 아티팩트 자율성 수준별로 전환

### 근거
- 기존 설계는 검색 도구 패러다임(고정 Phase 순차 흐름)에 기반. 대원칙(대화형 연구 동료)과 괴리
- "AI가 주도권을 제안한다"는 개념은 기존 UI/UX에 없으므로 창의적 접근 필요
- Phase 구조 제거: 대화형 시스템에서 사용자는 언제든 이전/다음을 오갈 수 있어야 함
- 분석 구조 고정 제거: 연구 동료라면 맥락에 따라 다른 분석을 제안해야 함

### 미완료 (다음 세션)
- ~~architecture.md, state-management.md, design-state-alignment.md, observability.md, conventions.md 재작성~~ → 세션 8에서 완료

## 2026-02-23 | Light House 하위 문서 완전 재작성 + 기술 결정
> 원본: `conversations/2026-02-23-세션8.md`

### 결정 사항

#### 문서 재작성 (5개)
1. **architecture.md** 완전 재작성 — 도메인 결 3가지(이벤트 스트림+리소스+워크플로), LLM 상위 에이전트 아키텍처(function calling 오케스트레이션), 대화 프로토콜(5개 메시지 타입), 3계층 기억 시스템, 4개 데이터 모델, 3-Plane 코드 매핑
2. **state-management.md** 완전 재작성 — Conversation=SSOT, 서버/클라이언트 상태 분리, 4개 Zustand 스토어(conversation/artifact/agent/ui), 에이전트 실행 FSM(자율성 수준별 경로), 아티팩트 관계 유형(parent-child/reference)
3. **design-state-alignment.md** 완전 재작성 — 핵심 명제 5개, 원칙-상태 매핑 7개, 상세 흐름 예시 4개(대화→검색, 클러스터링 제안→승인, 경험 기억 활용, 주도권 전환), 실패 사례 5개, 코드 리뷰 체크리스트 7개
4. **observability.md** 부분 재작성 — 상위 에이전트 관측 계층 신설(대화 턴, 도구 호출, 자율성 판단, 제안 카드 수락률, 주도권 전환, 기억 활용), Phase 참조 전면 제거, 카테고리 5개로 재편
5. **conventions.md** 업데이트 — 서버사이드 코드 규칙(agent/tools/repository 구조), 대화 프로토콜 타입 규칙(판별 유니온, 아티팩트 참조 마커), 아티팩트 타입 정의 규칙 추가

#### 기술 결정 (열린 질문 5개 해소)
1. **상위 에이전트 LLM**: Gemini 3 Flash Preview — tool calling + 대용량 컨텍스트
2. **스트리밍 구현**: Vercel AI SDK (`ai` + `@ai-sdk/google`) — tool calling + SSE 통합, 보일러플레이트 최소화
3. **서버사이드 저장**: Supabase (Postgres + Auth + RLS) — 인증 내장, Row Level Security로 사용자별 데이터 격리, 무료 티어 500MB
4. **경험 기억 범위**: 세션 간 포함 — 세션 종료 시 LLM이 핵심 기억 추출, 새 세션 시 최근 N개 세션의 전체 기억을 시스템 프롬프트에 주입. 기억 선별(유사도 기반)은 프로토타입에서 스킵
5. **기존 코드 재활용**: 핵심 로직(프롬프트, Zod 스키마, 응답 파싱) 추출하여 tool 함수로 재사용. API route 껍데기는 버림 (function calling으로 대체)

### 근거
- 보일러플레이트 최소화가 기술 선택의 일관된 기준 — AI SDK(tool calling 루프 자동화), Supabase(인증+DB 통합), 핵심 로직 재사용(프롬프트 재검증 불필요)
- 경험 기억은 Light House의 차별점 — "동료는 연구 여정 전체를 기억한다"를 프로토타입에서 빼면 챗봇과 구분 불가
- Supabase 채택: 경험 기억이 사용자별이므로 인증이 필수. Supabase Auth + RLS가 이를 DB 레벨에서 해결
- 파일 기반 저장 기각: Vercel 서버리스는 읽기 전용 파일시스템, 영속 불가

## 2026-02-23 | 일정 관리 체계 도입
> 원본: `conversations/2026-02-23-세션9.md`

### 결정 사항
1. task-management-principle.md에 "일정 연동" 섹션 추가 — 외부 공유/배포/테스트 마일스톤에 날짜와 must-have를 명시
2. 별도 캘린더 도구는 도입하지 않는다 — 문서에 날짜를 적는 것으로 충분
3. 일정: 2/24 팀 공유 → 2/26, 3/2 후속 공유 → 3월 1주 비공개 알파 테스트

### 근거
- 설계 단계에서는 시간 축이 불필요했으나, 외부 공유 일정이 생기면서 우선순위가 "중요도순"에서 "시연 가능 여부순"으로 전환
- "불확실성이 클 때는 단순하게 시작" 원칙에 따라 최소한의 시간 축만 추가
