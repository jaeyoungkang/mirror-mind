# 세션 13 — 시나리오 기반 구현 + Library v2 설계

**날짜**: 2026-02-24
**주제**: Light House 시나리오 기반 고도화 구현 지시, 대화 플로우 개선, Library v2 설계

## 진행 내용

### 1. 시스템 프롬프트 시나리오 인지 섹션 반영
- `system-prompt-scenario-section.md` → lighthouse `system-prompt.ts`에 반영 완료
- 삽입 위치: 동적 자율성 뒤, 주기적 중간 정리 앞

### 2. 대화 플로우 시나리오 기반 개선 (5건)
- 현재 7개 도구와 대화 플로우를 5가지 시나리오에 대조하여 갭 분석 수행
- 식별된 5개 갭:
  1. Snowballing 도구 부재 → `find_related_papers` 도구 신규 추가
  2. 연쇄 규칙이 시나리오 2와 충돌 → 시나리오별 연쇄 분기
  3. 메모리 주입 규칙이 시나리오 3,5와 충돌 → 시나리오별 참조 방식
  4. search_papers에 year 필터 없음 → 파라미터 추가
  5. cluster_papers 분류 기준 고정 → criteria 파라미터 추가
- 5건 모두 구현 완료

### 3. Library v2 설계
- v1 드래프트 검토: 시나리오와 무관한 범용 CRUD UI 문제 지적
- 핵심 전환: "대화만으로 부족한 순간"을 기준으로 재설계
  - 공간적 조망 (시나리오 1) → Landscape Panel
  - 일괄 비교 (시나리오 2) → Triage Panel
  - 축적 탐색 (교차 세션) → 탭 모드 (후순위)
- 인라인 모드: 기존 아티팩트 렌더러 강화 + 우측 사이드 패널
- 탭 모드: 축적이 충분해진 후 재논의

### 4. 사이드 패널 UI 구현
- NotebookShell 레이아웃 변경 (Board/Graph 제거, 사이드 패널 영역 추가)
- panel-store (Zustand), LandscapePanel, TriagePanel 구현
- ClusterPapersResult, SearchPapersResult에 패널 열기 버튼 추가
- find_related_papers 렌더러 추가
- 구현 완료, ClusterPapersResult "use client" 누락 버그 발견 → 수정 지시

### 5. 시연 검증 시나리오 구체화
- 시나리오 1 (새 분야 진입): 6단계 흐름 설계
- 시나리오 2 (제안서 준비): 6단계 흐름 설계
- 교차 세션 시나리오 (보너스): 2단계
- 검증 체크리스트 12항목 + 사이드 패널 검증 항목 17항목

## 미완료 (다음 세션)
- ClusterPapersResult "use client" 수정 확인
- 시연 검증 시나리오 실제 실행
- 사이드 패널 동작 검증 (체크리스트 기반)
- 시나리오 다듬기 계속
