# 세션 8 — Light House 하위 문서 완전 재작성 + 기술 결정 + 구현 프롬프트

## 날짜
2026-02-23

## 요약
Light House 서비스 재설계의 하위 문서 5개를 완전 재작성하고, 열린 질문 5개를 모두 해소하고, 구현 에이전트를 위한 6단계 프롬프트를 작성했다.

## 수행 내용

### 문서 재작성 (5개)
1. **architecture.md** — 도메인 결 3가지(이벤트 스트림+리소스+워크플로), LLM 상위 에이전트, function calling, 대화 프로토콜, 3계층 기억, 4개 데이터 모델, 3-Plane 매핑
2. **state-management.md** — Conversation=SSOT, 서버/클라이언트 분리, 4개 Zustand 스토어, 에이전트 실행 FSM
3. **design-state-alignment.md** — 핵심 명제 5개, 매핑 7개, 흐름 예시 4개, 실패 사례 5개, 체크리스트 7개
4. **observability.md** — 상위 에이전트 관측 계층 신설, Phase 참조 전면 제거
5. **conventions.md** — 서버사이드 코드, 대화 프로토콜 타입, 아티팩트 타입 규칙 추가

### 기술 결정 (5개)
1. 상위 에이전트 LLM → Gemini 3 Flash Preview
2. 스트리밍 → Vercel AI SDK (보일러플레이트 최소화)
3. 서버사이드 저장 → Supabase (인증+DB 통합, RLS)
   - 파일 기반은 Vercel 서버리스 읽기 전용으로 기각
   - Supabase는 사용자 제안, 인증 필요성이 결정적 근거
4. 경험 기억 → 세션 간 포함 (차별점)
5. 기존 코드 재활용 → 핵심 로직 추출하여 tool 함수로

### 구현 준비
- lighthouse CLAUDE.md, AGENT.md 갱신
- 6단계 구현 프롬프트 작성 (`projects/lighthouse/implementation-prompts.md`)
  - Phase 1: 기반 구축 (Supabase, AI SDK, 디렉토리, 타입)
  - Phase 2: 대화 코어 (시스템 프롬프트, 채팅 API, 캔버스 UI)
  - Phase 3: 도구 통합 (기존 로직 추출, tool 함수 등록)
  - Phase 4: 아티팩트 (인라인 렌더러, 생명주기, Thinking HUD)
  - Phase 5: 제안 카드 + 자율성 (FSM 게이트, 주도권 신호)
  - Phase 6: 경험 기억 (추출, 주입, 타임라인)

## 의사결정
→ `tasks/decisions.md` "2026-02-23 | Light House 하위 문서 완전 재작성 + 기술 결정" 참조

## 다음 세션
- lighthouse 저장소에서 구현 착수 (Phase 1부터)
